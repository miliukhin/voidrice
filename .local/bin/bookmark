#!/bin/sh

getbookmark() {
	bookmark="$(xclip -selection clipboard -o)"
	tags=$(echo "" | dmenu -p "Enter bookmark tags (ENTER to save without tags)")
}

write_to_file () {
	if grep -q -E "^$bookmark( |$)" "$file"; then
		notify-send "Already bookmarked $bookmark!"
	else
		notify-send "Bookmarked $bookmark"
		echo "$bookmark" "$tags" >> "$file"
		echo "$bookmark" | xclip -selection clipboard -i
	fi
}

case "$(printf "ğŸ“œ rss\nğŸŒ url\nğŸŒğŸ“œ site (rss + url)\nğŸµ song" | dmenu -i -p 'Bookmark: ')" in
	'ğŸŒğŸ“œ site (rss + url)') getbookmark && rssget "$bookmark" "$tags" && file="$HOME/.local/share/larbs/snippets" && write_to_file ;;
	'ğŸ“œ rss') getbookmark && rssget "$bookmark" "$tags" ;;
	'ğŸŒ url') getbookmark && file="$HOME/.local/share/larbs/snippets" && write_to_file ;;
	'ğŸµ song') bookmark="$(mpc | sed "/^volume:/d;s/\\&/&amp;/g;s/\\[paused\\].*/â¸/g;/\\[playing\\].*/d;/^ERROR/Q")"
		file="$HOME/.local/share/larbs/songlog" && write_to_file ;;
	*) exit 1 ;;
esac
